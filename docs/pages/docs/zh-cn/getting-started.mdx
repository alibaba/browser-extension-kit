---
title: 快速开始
---

# 快速开始

## 安装
```bash
npm i browser-extension-kit -S
// or
yarn add browser-extension-kit
```
## 说明

在开始开发前，你需要了解 chrome 插件的基本设计思想和组成。本框架专注解决插件开发过程中最大的痛点——消息传递机制，对于 chrome 本身提供的丰富的 API，你仍然需要自行调用。

在 chrome 插件的官方设计思路中，一个插件包含 5 种互相隔离的执行环境：
- background
- content-script
- page-script
- devtools
- popup

在 `browser-extension-kit` 中，根据这 5 种执行环境，抽象出了 3 个基类和 2 个 React hooks：
- `Background`：基类，在 background 中执行的逻辑都需要继承这个基类
- `ContentScript`：基类，在 content-script 中执行的逻辑都需要继承这个基类
- `PageScript`：基类，在 page-script 中执行的逻辑都需要继承这个基类
- `useMessage`: hooks，用在 devtools 和 popup 这 2 个 UI 界面相关的执行环境中
- `usePostMessage`: hooks，用在 devtools 和 popup 这 2 个 UI 界面相关的执行环境中

对于 UI 类的执行环境，本质上是一个 React 组件，本框架不做过多限制。对于其余 3 个执行环境，都需要调用对应基类上的静态方法 `bootstrap` 来进行初始化。

## 举例
假设我们需要做一个插件，这个插件需要轮询服务器获取某项数据，并且在 popup 中展示该数据，而轮询接口的参数需要在 popup 中由用户输入。
首先，我们需要实现 background 中的逻辑，任何一个插件都必须有一个 background，我们在 background 中处理事务。通常情况下，你应该把所有核心业务逻辑和状态定义在 background 中。
```ts
// src/background/myBackground.ts
import { interval, from, Subject } from 'rxjs';
import axios from 'axios';
import { Background } from 'browser-extension-kit/background';
import { observable, subject } from 'browser-extension-kit';
import { withLatestFrom, shareReplay, switchMap } from 'rxjs/operators';

export default class MyBackground extends Background {
  // 使用 @subject('MyBackground::id') 来指定监听 id 为 MyBackground::id 的消息
  // 并自动将这个消息的 data 转化为 idSubject 的下一个值
  @subject('MyBackground::id') private idSubject = new Subject<string>();

  // 使用 @observable.popup() 来自动订阅 data$，并把每次发出的值通过消息传递给 popup
  // 消息的 id 默认为 MyBackground::data$
  @observable.popup() private data$ = interval(3000).pipe(
    withLatestFrom(this.idSubject),
    switchMap(([_, id]) => from(axios.get('/api/data', { params: { id }}))),
  ).pipe(
    shareReplay(1)
  );
}
```
```ts
// src/background/index.ts
import { Background } from 'browser-extension-kit/background';
import MyBackground from './MyBackground.ts';

// 使用 bootstrap 来初始化
Background.bootstrap(MyBackground);
```
```ts
// src/popup/App.tsx
import React, { ChangeEvent, useCallback } from 'react';
import { useMessage, usePostMessage } from 'browser-extension-kit/popup';

const App = () => {
  const port = usePostMessage();
  const data = useMessage<string>('MyBackground::data$', ''); // 接受 id 为 MyBackground::data$ 的消息并指定默认值

  const handleChange = useCallback((e: ChangeEvent<HTMLInputElement>) => {
    port.background('MyBackground::id', e.target.value) // 向 background 发送 id 为 MyBackground::id 的消息
  }, [port]);

  return (
    <div>
      current data: {data}
      input id param: <input onChange={handleChange} />
    </div>
  );
};

export default App;
```
注意在这里的例子中，background 使用了 rxjs 来管理数据，你也可以不使用 rxjs，框架也提供了更底层的 API 供你调用，详见 API 文档。​
