---
title: 概览
---

# 概览

一些背景

Chrome 插件开发的难点在于存在多个执行环境：

- background
- popup
- content-script
- page-script
- devtool

这些环境之间互相隔离，通信只能依靠 `message` 来实现。Chrome 插件本身提供了基于 `postMessage` 的消息传递机制，但是一旦实际使用过一段时间后，你会发现其 API 并没有那么好用。比如说：

- 不同执行环境之间，需要区分内部消息和外部消息（如 page-script 和 background 通信），他们的 API 存在差异
- 建立连接的顺序：主动建立连接的一方应该是生命周期较短的一方，但是生命周期在不同的场景下可能完全相反，例如 devtools 和 page-script 之间，完全取决于 devtools 的打开关闭时机
- 并不是任意 2 个执行环境之间都可以直接建立连接，例如 page-script -> content-script -> background -> devtools
- message 传递方式有多种，需要根据实际情况区分使用，例如 page-script -> content-script，即可以使用 chrome 的 API（需要 background 中转），也可以直接使用 `window.postMessage`

基于这些原因，诞生了 `browser-extension-kit` ——一个帮助你开发 Chrome 插件的框架。
